<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DORA</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <link href="https://db.onlinewebfonts.com/c/87de6bcedaa28b9a81b24587815faf41?family=Felix+Titling" rel="stylesheet">
    <style>
        :root {
            --bg-dark: #3e0f36; /* Dark Purple */
            --color-neon: #c2ff3f; /* Neon Green */
            --color-white: #ffffff;
            --color-input-bg: #2a0a25;
            --color-title: #c2ff3f;
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-dark);
            color: var(--color-white);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 2rem 1rem;
        }
        h1 {
            font-family: "Felix Titling"; /* H1 font applied via inline style/CSS */
            color: var(--color-title);
            /* Increased shadow for a stronger neon effect */
            text-shadow: 0 0 10px var(--color-neon), 0 0 20px rgba(194, 255, 63, 0.4); 
            font-size: 3rem; /* Large size */
            font-weight: 900;
            line-height: 1.1;
            letter-spacing: 2px; /* Added letter spacing */
        }
        .btn-primary {
            background-color: var(--color-neon);
            color: #000000;
            font-weight: 700;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            transition: background-color 0.2s, transform 0.1s;
            box-shadow: 0 4px 6px -1px rgba(194, 255, 63, 0.5), 0 2px 4px -2px rgba(194, 255, 63, 0.5);
        }
        .btn-primary:hover:not(:disabled) {
            background-color: #a4e634;
            transform: translateY(-1px);
        }
        .btn-primary:disabled {
            background-color: #6d6d6d;
            cursor: not-allowed;
            box-shadow: none;
        }
        #video-container {
            width: 100%;
            max-width: 500px;
            aspect-ratio: 4/3;
            background-color: var(--color-input-bg);
            border: 2px solid var(--color-neon);
            box-shadow: 0 0 20px rgba(194, 255, 63, 0.3);
            border-radius: 0.75rem;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        #video-stream {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: none; /* Hidden until stream starts */
        }
        #image-gallery-container {
            border: 1px solid rgba(194, 255, 63, 0.2);
            background-color: var(--color-input-bg);
            min-height: 100px;
        }
        .captured-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 0.5rem;
            transition: transform 0.3s;
        }
        .captured-image:hover {
            transform: scale(1.05);
        }
        /* Mobile adjustment for title size */
        @media (max-width: 768px) {
            h1 {
                font-size: 3rem; 
            }
        }
    </style>
</head>
<body>
    <!-- Logo moved to top-left -->
    <a href="index.html" class="fixed top-6 left-6 z-50 transition-transform duration-300 hover:scale-105" title="Go back to main page">
        <div class="text-2xl font-black" style="color: var(--color-neon);">
            <img src="logo.png" alt="PANDORA Logo" width="50" height="50">
        </div>
    </a>
    <div id="message-box" class="fixed top-4 left-1/2 transform -translate-x-1/2 p-4 rounded-lg shadow-xl z-50 transition-opacity duration-300 opacity-0 pointer-events-none text-sm font-semibold"></div>

    <div class="w-full max-w-4xl mx-auto space-y-8">
        <header class="text-center">
            <h1 class="mb-6 text-4xl font-black">PROJECT REPORT</h1>
            <p class="text-gray-300 text-lg">Activate the camera, capture a frame, and save it to the gallery.</p>
        </header>
        
        <main class="flex flex-col md:flex-row gap-8">
            <!-- Left Side: Video Stream and Controls -->
            <div class="md:w-1/2 flex flex-col items-center space-y-4">
                <div id="video-container">
                    <video id="video-stream" autoplay playsinline></video>
                    <div id="placeholder" class="text-gray-500 p-4 text-center">
                        Click 'Start Camera' to activate video stream.
                    </div>
                </div>

                <div class="flex space-x-4">
                    <button id="start-btn" class="btn-primary">
                        Start Camera
                    </button>
                    <button id="capture-btn" class="btn-primary" disabled>
                        Capture Image
                    </button>
                </div>
                <!-- Hidden canvas for image capture -->
                <canvas id="capture-canvas" style="display:none;"></canvas>
            </div>

            <!-- Right Side: Captured Images (Gallery) -->
            <div class="md:w-1/2">
                <h2 class="text-xl font-bold text-gray-200 mb-4 border-b border-gray-700 pb-2">
                    Captured Image Gallery
                </h2>
                <div id="image-gallery-container" class="p-4 grid grid-cols-2 gap-4 rounded-lg shadow-lg">
                    <p id="empty-gallery-msg" class="text-gray-500 col-span-2 text-center">No images captured yet.</p>
                </div>
            </div>
        </main>
    </div>

    <script>
        // --- DOM Elements ---
        const video = document.getElementById('video-stream');
        const canvas = document.getElementById('capture-canvas');
        const startBtn = document.getElementById('start-btn');
        const captureBtn = document.getElementById('capture-btn');
        const gallery = document.getElementById('image-gallery-container');
        const placeholder = document.getElementById('placeholder');
        const emptyMsg = document.getElementById('empty-gallery-msg');
        const messageBox = document.getElementById('message-box');
        
        let mediaStream = null;

        // --- Utility Functions ---

        /**
         * Displays a non-blocking message to the user.
         */
        function displayMessage(message, type = 'info') {
            let bgColor = 'bg-gray-700';
            
            if (type === 'error') {
                bgColor = 'bg-red-700';
            } else if (type === 'success') {
                bgColor = 'bg-green-700';
            }

            // Set classes for visibility and style
            messageBox.className = `fixed top-4 left-1/2 transform -translate-x-1/2 p-4 rounded-lg shadow-xl z-50 transition-opacity duration-300 ${bgColor} text-white opacity-100`;
            messageBox.innerHTML = message;
            
            // Auto-hide after 4 seconds
            setTimeout(() => {
                messageBox.classList.remove('opacity-100');
                messageBox.classList.add('opacity-0');
                setTimeout(() => messageBox.classList.add('pointer-events-none'), 300); 
            }, 4000);
        }

        /**
         * 1. Requests access to the user's camera.
         * 2. Starts streaming video to the <video> element.
         */
        async function startCamera() {
            if (mediaStream) {
                // If camera is already running, stop it first
                mediaStream.getTracks().forEach(track => track.stop());
            }

            try {
                // Request video stream
                mediaStream = await navigator.mediaDevices.getUserMedia({ video: true });
                
                // Attach stream to video element
                video.srcObject = mediaStream;
                video.style.display = 'block';
                placeholder.style.display = 'none';

                // Wait for the video to load metadata (like resolution)
                await new Promise((resolve) => {
                    video.onloadedmetadata = () => {
                        // Set canvas dimensions to match video stream
                        canvas.width = video.videoWidth;
                        canvas.height = video.videoHeight;
                        resolve();
                    };
                });
                
                // Update UI state
                startBtn.textContent = 'Stop Camera';
                startBtn.classList.remove('bg-green-600');
                startBtn.classList.add('bg-red-600');
                captureBtn.disabled = false;
                displayMessage("Camera started successfully.", 'success');

            } catch (err) {
                console.error("Error accessing camera: ", err);
                displayMessage("Error accessing camera. Check permissions.", 'error');
                video.style.display = 'none';
                placeholder.style.display = 'block';
                startBtn.textContent = 'Start Camera';
                captureBtn.disabled = true;
            }
        }

        /**
         * Stops the camera stream.
         */
        function stopCamera() {
            if (mediaStream) {
                mediaStream.getTracks().forEach(track => track.stop());
                mediaStream = null;
                video.srcObject = null;
                
                video.style.display = 'none';
                placeholder.style.display = 'block';

                startBtn.textContent = 'Start Camera';
                startBtn.classList.remove('bg-red-600');
                startBtn.classList.add('bg-green-600');
                captureBtn.disabled = true;
                displayMessage("Camera stopped.", 'info');
            }
        }

        /**
         * Captures the current frame from the video stream and displays it.
         */
        function captureImage() {
            if (!mediaStream) {
                displayMessage("Camera not active. Click 'Start Camera' first.", 'error');
                return;
            }
            
            // 1. Draw the current video frame onto the hidden canvas
            const context = canvas.getContext('2d');
            // Ensure the canvas size is correct before drawing
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            
            context.drawImage(video, 0, 0, canvas.width, canvas.height);
            
            // 2. Convert the canvas content to a PNG Data URL
            const imageDataURL = canvas.toDataURL('image/png');
            
            // 3. Create the image element
            const imageContainer = document.createElement('div');
            imageContainer.className = 'w-full h-auto aspect-square overflow-hidden';
            
            const newImage = document.createElement('img');
            newImage.src = imageDataURL;
            newImage.alt = `Captured Image ${new Date().toLocaleTimeString()}`;
            newImage.className = 'captured-image';

            imageContainer.appendChild(newImage);

            // 4. Add the new image to the gallery
            gallery.prepend(imageContainer); 

            // 5. Hide the 'No images' message
            emptyMsg.style.display = 'none';
            
            displayMessage("Image captured and saved to gallery!", 'success');
        }

        // --- Event Listeners ---
        startBtn.addEventListener('click', () => {
            if (mediaStream) {
                stopCamera();
            } else {
                startCamera();
            }
        });
        
        captureBtn.addEventListener('click', captureImage);

        // Cleanup on window close/reload
        window.addEventListener('beforeunload', () => {
            if (mediaStream) {
                mediaStream.getTracks().forEach(track => track.stop());
            }
        });

    </script>
</body>
</html>